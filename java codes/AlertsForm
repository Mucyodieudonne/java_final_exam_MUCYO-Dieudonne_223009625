
package com.IoT;

import javax.swing.*;
import javax.swing.table.*;
import java.sql.*;
import java.awt.*;

public class AlertsForm extends JFrame {
    
    JTable table;
    DefaultTableModel model;

    public AlertsForm() {
        setTitle("Alerts Manager");
        setSize(900, 600);
        setLocationRelativeTo(null);
        setLayout(new BorderLayout());

        model = new DefaultTableModel(new String[]{"Alert ID", "Sensor ID", "Type", "Message", "Status", "Created At"}, 0);
        table = new JTable(model);

        JScrollPane scroll = new JScrollPane(table);
        add(scroll, BorderLayout.CENTER);

        loadData();

        setVisible(true);
        setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
    }

    void loadData() {
        model.setRowCount(0); // clear

        String query = "SELECT alert_id, sensor_id, alert_type, message, status, created_at FROM alerts";

        try (Connection conn = DB.getConnection();
             Statement st = conn.createStatement();
             ResultSet rs = st.executeQuery(query)) {

            while (rs.next()) {
                model.addRow(new Object[]{
                    rs.getInt("alert_id"),
                    rs.getInt("sensor_id"),
                    rs.getString("alert_type"),
                    rs.getString("message"),
                    rs.getString("status"),
                    rs.getString("created_at")
                });
            }

        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Error loading alerts: " + e.getMessage());
        }
    }
}
